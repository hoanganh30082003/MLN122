:root{ --primary:#C53030; --secondary:#D69E2E; --linen:#FAF3E0; --charcoal:#2C2C2C;
  --radius-lg:20px; --shadow:0 10px 30px rgba(0,0,0,.12); }

.factory-wrap{ min-height:100vh; padding:40px 0 70px; background:var(--linen); }
.fx-head{ margin-bottom:12px }
.fx-title{ font-family:"Merriweather",serif; color:var(--primary); font-size:clamp(34px,3vw,48px); margin:0 0 6px }
.fx-sub{ opacity:.95; font-size:clamp(16px,1.2vw,20px); }

.fx-switch{ display:flex; gap:10px; margin:14px 0 16px; flex-wrap:wrap }
.pill{ background:#fff; border:2px solid #00000012; padding:10px 16px; border-radius:999px;
  font-weight:800; cursor:pointer; box-shadow:var(--shadow);
  transition:transform .2s cubic-bezier(.2,.8,.2,1), box-shadow .2s, background .2s, color .2s; }
.pill:hover{ transform:translateY(-2px); box-shadow:0 14px 36px rgba(0,0,0,.16) }
.pill.active{ background:var(--secondary); color:#351 }
.card{ background:#fff; border:2px solid #00000012; border-radius:var(--radius-lg); box-shadow:var(--shadow) }

/* --- PIPELINE LAYOUT (fixed alignment) --- */
.pipeline{
  position:relative; display:grid; grid-template-columns:1fr 60px 1fr 60px 1fr 60px 1fr;
  align-items:stretch; grid-auto-rows:1fr;
  gap:12px; padding:18px; min-height:360px; overflow:hidden;padding-bottom: 80px;
}
.stage{
  height:100%; display:flex; flex-direction:column;
  background:#fff; border-radius:16px; border:2px solid #00000012; padding:14px 16px;
  transition:transform .22s cubic-bezier(.2,.8,.2,1), box-shadow .22s, filter .22s;
}
.stage:hover{ transform:translateY(-2px); box-shadow:0 14px 36px rgba(0,0,0,.16); filter:saturate(1.03) }

.st-head{ display:flex; align-items:center; gap:10px; margin-bottom:6px }
.st-ico{ width:34px; height:34px; border-radius:10px; display:grid; place-items:center; background:var(--secondary) }
.st-ico svg{ width:20px; height:20px; }
.st-title{ font-weight:900; color:#2a2a2a }
.st-body{ flex:1; display:flex; flex-direction:column; justify-content:space-between }
.st-body .st-note{ opacity:.92; margin-top:8px; line-height:1.6 }

.arrow{ align-self:stretch; display:flex; align-items:center; justify-content:center }
.arr{
  width:44px; height:10px; border-radius:999px;
  background:linear-gradient(90deg, var(--primary), var(--secondary));
  opacity:.9;
}

/* tags */
.parts{ display:flex; flex-wrap:wrap; gap:8px }
.part{
  background:#fff; border:1px solid #00000012; border-radius:999px; padding:6px 10px; font-weight:700;
  box-shadow:var(--shadow); transition:transform .18s, background .18s, color .18s;
}
.part:hover{ background:var(--secondary); color:#351; transform:translateY(-1px) }

.brands{ display:flex; gap:8px; flex-wrap:wrap }
.brand{
  background:linear-gradient(#fff,#fff) padding-box,
             linear-gradient(135deg, rgba(214,158,46,.35), rgba(197,48,48,.35)) border-box;
  border:2px solid transparent; border-radius:12px; padding:6px 10px; font-weight:900;
  box-shadow:var(--shadow); transition:transform .2s, filter .2s, box-shadow .2s;
}
.brand:hover{ transform:translateY(-1px); filter:saturate(1.06); box-shadow:0 12px 28px rgba(0,0,0,.16) }
.track{
  position:absolute; left:18px; right:18px; bottom:10px; height:56px; border-radius:999px;
  background:linear-gradient(180deg,#f3ead6,#efe1c1); border:1px solid #00000012;
  box-shadow:inset 0 6px 18px rgba(0,0,0,.05);
  overflow: hidden;
  --pkgw:44px;   
  --pkgh:36px; 
  --speed:18s;  
}

.pkg{
  position:absolute;
  top: 50%;
  left: calc(-1 * var(--pkgw));    
  width: var(--pkgw);
  height: var(--pkgh);
  transform: translateY(-50%);  
  display:grid; place-items:center;
  border-radius:10px;
  background:#fff; border:2px solid #00000012; box-shadow:var(--shadow);
  animation: runAcross var(--speed) linear infinite;
  will-change: left;
}
.pkg svg{ width:18px; height:18px; }

/* Chia pha đều: 4 kiện cách nhau 1/4 chu kỳ */
.pkg:nth-child(1){ animation-delay: 0s; }
.pkg:nth-child(2){ animation-delay: calc(-1 * var(--speed) / 4); }
.pkg:nth-child(3){ animation-delay: calc(-2 * var(--speed) / 4); }
.pkg:nth-child(4){ animation-delay: calc(-3 * var(--speed) / 4); }

/* Chạy xuyên suốt chiều rộng track (theo PARENT) */
@keyframes runAcross{
  0%   { left: calc(-1 * var(--pkgw)); }
  100% { left: calc(100% + var(--pkgw)); }  /* ra khỏi mép phải */
}

/* metrics + notes */
.fx-metrics{ display:grid; grid-template-columns:repeat(3,1fr); gap:16px; margin:16px 0 }
@media (max-width:900px){ .fx-metrics{ grid-template-columns:1fr; } }
.metric{
  background:#fff; border-radius:var(--radius-lg); border:2px solid #00000012; box-shadow:var(--shadow);
  padding:16px 18px; transition:transform .22s cubic-bezier(.2,.8,.2,1), box-shadow .22s;
}
.metric:hover{ transform:translateY(-2px); box-shadow:0 14px 36px rgba(0,0,0,.16) }
.m-title{ font-weight:800; color:#2a2a2a }
.m-val{ font-weight:900; color:var(--primary); font-size:clamp(28px,3.2vw,42px); margin:4px 0 2px }
.m-foot{ opacity:.85 }

.fx-notes{ display:grid; grid-template-columns:1fr 1fr; gap:16px; padding:16px }
@media (max-width:900px){ .fx-notes{ grid-template-columns:1fr; } }
.nx-col{ background:#fff; border-radius:16px; border:2px solid #00000012; padding:14px 16px; box-shadow:var(--shadow) }
.nx-pill{ display:inline-block; background:var(--primary); color:#fff; padding:6px 12px; border-radius:999px;
  font-weight:800; letter-spacing:.3px; margin-bottom:8px }

/* responsive: nếu màn nhỏ, ẩn đường ray để tránh vỡ layout */
@media (max-width:960px){
  .pipeline{ grid-template-columns:1fr; min-height:unset }
  .arrow, .track{ display:none }
}
